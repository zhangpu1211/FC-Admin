<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.fcadmin.mapper.MenuMapper" >
  <resultMap id="BaseResultMap" type="org.fcadmin.pojo.Menu" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="url" property="url" jdbcType="VARCHAR" />
    <result column="path" property="path" jdbcType="VARCHAR" />
    <result column="component" property="component" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="icon_cls" property="iconCls" jdbcType="VARCHAR" />
    <result column="keep_alive" property="keepAlive" jdbcType="BIT" />
    <result column="require_auth" property="requireAuth" jdbcType="BIT" />
    <result column="parent_id" property="parentId" jdbcType="INTEGER" />
    <result column="enabled" property="enabled" jdbcType="BIT" />
    <result column="sort" property="sort" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="delete_time" property="deleteTime" jdbcType="TIMESTAMP" />
  </resultMap>

  <resultMap id="BaseMenuVo" type="org.fcadmin.vo.MenuVO" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="url" property="url" jdbcType="VARCHAR" />
    <result column="path" property="path" jdbcType="VARCHAR" />
    <result column="component" property="component" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="icon_cls" property="iconCls" jdbcType="VARCHAR" />
    <result column="parent_id" property="parentId" jdbcType="INTEGER" />
    <result column="enabled" property="enabled" jdbcType="BIT" />
    <result column="sort" property="sort" jdbcType="INTEGER" />
    <association property="meta" javaType="org.fcadmin.pojo.Meta">
      <result column="keep_alive" property="keepAlive" jdbcType="BIT" />
      <result column="require_auth" property="requireAuth" jdbcType="BIT" />
    </association>
  </resultMap>
  <!--  获取用户有权限的菜单-->
  <resultMap id="getMenusBySysUserId" type="org.fcadmin.vo.MenuVO" extends="BaseMenuVo">
    <collection property="children" ofType="org.fcadmin.vo.MenuVO">
      <id column="id2" property="id" jdbcType="INTEGER" />
      <result column="url2" property="url" jdbcType="VARCHAR" />
      <result column="path2" property="path" jdbcType="VARCHAR" />
      <result column="component2" property="component" jdbcType="VARCHAR" />
      <result column="name2" property="name" jdbcType="VARCHAR" />
      <result column="icon_cls2" property="iconCls" jdbcType="VARCHAR" />
      <result column="parent_id2" property="parentId" jdbcType="INTEGER" />
      <result column="enabled" property="enabled" jdbcType="BIT" />
      <result column="sort" property="sort" jdbcType="INTEGER" />
      <association property="meta" javaType="org.fcadmin.pojo.Meta">
        <result column="keep_alive2" property="keepAlive" jdbcType="BIT" />
        <result column="require_auth2" property="requireAuth" jdbcType="BIT" />
      </association>
    </collection>
  </resultMap>
  <select id="getMenusBySysUserId" resultMap="getMenusBySysUserId">
    SELECT m1.*,m2.id as id2,m2.component as component2,m2.enabled as enabled2,m2.icon_cls as icon_cls2,m2.keep_alive as keep_alive2,
    m2.name as name2,m2.parent_id as parent_id2,m2.require_auth as require_auth2,m2.path as path2 FROM menu m1, menu m2,
    menu_role mr,sys_user_role sur
    WHERE m1.id = m2.parent_id AND sur.sys_user_id = #{id} AND mr.rid = sur.rid AND m2.id = mr.mid AND m2.enabled = 1 ORDER BY m1.sort desc,m2.sort desc ,m1.id asc,m2.id asc
  </select>
<!--获取系统所有权限-->
  <resultMap id="getSystemMenus" type="org.fcadmin.vo.MenuVO" extends="BaseMenuVo">
    <collection property="children" ofType="org.fcadmin.vo.MenuVO" column="id" select="getMenusByPid">
      <id column="id" property="id" jdbcType="INTEGER" />
      <result column="url" property="url" jdbcType="VARCHAR" />
      <result column="path" property="path" jdbcType="VARCHAR" />
      <result column="component" property="component" jdbcType="VARCHAR" />
      <result column="name" property="name" jdbcType="VARCHAR" />
      <result column="icon_cls" property="iconCls" jdbcType="VARCHAR" />
      <result column="parent_id" property="parentId" jdbcType="INTEGER" />
      <result column="enabled" property="enabled" jdbcType="BIT" />
      <result column="sort" property="sort" jdbcType="INTEGER" />
      <association property="meta" javaType="org.fcadmin.pojo.Meta">
        <result column="keep_alive" property="keepAlive" jdbcType="BIT" />
        <result column="require_auth" property="requireAuth" jdbcType="BIT" />
      </association>
    </collection>
  </resultMap>
  <select id="getSystemMenus" resultMap="getSystemMenus">
    SELECT id,url,path,component,name,icon_cls,keep_alive, require_auth,parent_id,enabled,sort FROM menu WHERE parent_id = 0
  </select>
  <select id="getMenusByPid" resultMap="getSystemMenus">
    SELECT id,url,path,component,name,icon_cls,keep_alive, require_auth,parent_id,enabled,sort FROM menu WHERE parent_id = #{id}
  </select>

<!--获取每一个menu所拥有的权限-->
  <resultMap id="MenuWithRoles" type="org.fcadmin.dto.MenuWithRolesDTO" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="url" property="url" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <collection property="roles" ofType="org.fcadmin.pojo.Role">
      <id column="rid" property="id"/>
      <result column="name" property="name" jdbcType="VARCHAR" />
      <result column="name_zh" property="nameZh" jdbcType="VARCHAR" />
    </collection>
  </resultMap>
  <select id="getAllMenusWithRole" resultMap="MenuWithRoles">
    select m.*,r.`id` as rid,r.`name` as rname,r.`name_zh` as rnameZh from menu m,menu_role mr,role r where m.`id`=mr.`mid` and mr.`rid`=r.`id` order by m.`id`
  </select>

  <select id="getIdsByPid" resultType="Integer">
    select id from menu where parent_id = #{id}
  </select>

<!--  角色管理相关方法-->
  <select id="getMenuIdsByRid" resultType="java.lang.Integer">
    select mid from menu_role where rid=#{rid};
  </select>
</mapper>